---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Primož Durcik"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

ANALIZA PRESELJEVANJA V EVROPI

V projektu bom analiziral preseljevanje prebivalstva v Evropi. Zbral bom podatke (nekaterih) evropskih držav za obdobje med letoma 2008 in 2015 glede na državljanstvo, spol in glede na starostno skupino priseljenega prebivalstva. Analiziral in predstavil bom, kako se je spreminjalo število priseljenih v teh državah glede na omenjene kategorije in primerjal število priseljenih ljudi s številom pridobljenih državljanstev in prošenj za azil za določene skupine ljudi.

V prvi tabeli bom meril število priseljenih. Stolpci bodo:
* leto
* država
* državljanstvo
* spol
* število priseljencev.

V drugi tabeli bom meril število pridobljenih državljanstev. Stolpci bodo:
* leto
* država
* državljanstvo
* spol
* število pridobljenih državljanstev.

V tretji tabeli bom meril število azilantov. Stolpci bodo:
* leto
* država
* število azilantov.

V četrti tabeli bom meril število prijavljenih beguncev. Stolpci bodo:
* leto
* država
* število prijavljenih beguncev.

Viri podatkov:

* `http://ec.europa.eu/eurostat/web/population-demography-migration-projections/migration-and-citizenship-data/database`
* `http://www.pewglobal.org/2016/08/02/number-of-refugees-to-europe-surges-to-record-1-3-million-in-2015/`
* `http://www.economist.com/blogs/graphicdetail/2016/03/daily-chart-20`
* `https://en.wikipedia.org/wiki/List_of_countries_by_refugee_population`

Podatki bodo v CSV (prvi vir) in HTML (drugi, tretji in četrti vir) obliki.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozil sem podatke o priseljenih ljudi z Eurostata v obliki CSV in z Wikipedije v obliki HTML. Spodaj si lahko ogledamo začetek razpredelnice v kateri merimo število pridobljenih državljanstev in začetek tabele v kateri merimo število azilantov po državah.

```{r razpredelnice}
head(drzavljanstva)
head(azil)
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Slika \ref{fig:zemljevid} prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data = left_join(zemljevid, povprecja, by = c("OB_UIME" = "obcina")),
                        aes(x = long, y = lat, group = group, fill = povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill = guide_colorbar(title = "Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Slika \ref{fig:graf} prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina = names(skupine),
                                     skupina = factor(skupine)), by = "obcina")
, aes(x = povrsina, y = naselja, color = skupina, size = prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color = guide_legend(title = "Skupina"),
         size = guide_legend(title = "Prebivalci (* 1000)"))
```

***

```{r shiny, echo = FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
